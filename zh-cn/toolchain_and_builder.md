# å·¥å…·é“¾å’Œæ„å»ºé…ç½®ä»‹ç»

## æ”¯æŒçš„å·¥å…·é“¾

- ### Keil_C51 å·¥å…·é“¾

  ä»‹ç»ï¼šä½¿ç”¨ KEIL C51 å†…ç½®çš„ç¼–è¯‘å·¥å…·è¿›è¡Œç¼–è¯‘

  > é€‚ç”¨é¡¹ç›®: 8051 é¡¹ç›®

  > æç¤ºï¼šæ’ä»¶ä½¿ç”¨çš„ Keil_C51 å·¥å…·é“¾çš„ é“¾æ¥å™¨ å’Œ æ±‡ç¼–å™¨ ä¸º LX51 å’Œ A51

  !> **æ³¨æ„**ï¼šä½¿ç”¨å‰å¿…é¡»å®Œå…¨ç ´è§£ Keil C51ï¼Œå¦åˆ™å¯èƒ½ä¼šé“¾æ¥å¤±è´¥

- ### SDCC (Small Device C Compiler) å·¥å…·é“¾

  ä»‹ç»ï¼šä½¿ç”¨å…è´¹çš„ç¼–è¯‘å·¥å…· [Small Device C Compiler](http://sdcc.sourceforge.net/) è¿›è¡Œç¼–è¯‘

  > é€‚ç”¨é¡¹ç›®: 8051, STM8, Z80 ... é¡¹ç›®
  
  !> **æ³¨æ„**ï¼šå¼ºçƒˆå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ SDCC, ç›®å‰æ˜¯ 4.0, å› ä¸ºè¿‡æ—§çš„ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒå¤šæ–‡ä»¶ç¼–è¯‘ï¼Œä»¥åŠæŸäº›é‡è¦çš„ç¼–è¯‘å‚æ•°, è¿™å¯èƒ½ä¼šå¼•å‘ä¸€ç³»åˆ—çš„ç¼–è¯‘é”™è¯¯

- ### IAR-STM8 å·¥å…·é“¾

  ä»‹ç»ï¼šä½¿ç”¨ IAR-STM8 è‡ªå¸¦çš„ç¼–è¯‘å·¥å…· iccstm8 è¿›è¡Œç¼–è¯‘

  > é€‚ç”¨é¡¹ç›®: STM8 é¡¹ç›®

  !> **æ³¨æ„**ï¼šä½¿ç”¨å‰å¿…é¡»å®Œå…¨ç ´è§£ IAR-STM8

- ### AC5/AC6 (ARMCC) å·¥å…·é“¾

  ä»‹ç»ï¼šä½¿ç”¨ Keil-MDK è‡ªå¸¦çš„ç¼–è¯‘å·¥å…· ARMCC è¿›è¡Œç¼–è¯‘

  > é€‚ç”¨é¡¹ç›®: Cortex-M é¡¹ç›®

  > æç¤ºï¼šAC5 æ˜¯æŒ‡ ARMCC ç‰ˆæœ¬ 5 çš„ç¼–è¯‘å·¥å…·;  AC6 æ˜¯æŒ‡ ARMClang ç¼–è¯‘å·¥å…·

  !> **æ³¨æ„**ï¼šä½¿ç”¨å‰å¿…é¡»å®Œå…¨ç ´è§£ Keil-MDK

- ### ARM-GCC (GNU Arm Embedded Toolchain) å·¥å…·é“¾

  ä»‹ç»ï¼šä½¿ç”¨å…è´¹çš„ç¼–è¯‘å·¥å…· [GNU Arm Embedded Toolchain](https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads) è¿›è¡Œç¼–è¯‘

  > é€‚ç”¨é¡¹ç›®: Cortex-M é¡¹ç›®

***

## ç¼–è¯‘é…ç½®

### éARMå·¥ç¨‹

> eide ä½¿ç”¨ json æ–‡ä»¶ä¿å­˜æ‰€æœ‰çš„ç¼–è¯‘é€‰é¡¹ï¼Œç‚¹å‡» **ç¼–è¯‘å™¨é€‰é¡¹** ä¸Šçš„ **æ›´æ”¹** æŒ‰é’®å³å¯æ‰“å¼€ json é…ç½®
> 
> json é…ç½®çš„æ‰€æœ‰å­—æ®µå¸¦æœ‰æ‚¬åœæç¤ºå’Œè¡¥å…¨ï¼Œå¯ä»¥æ ¹æ®æ‚¬åœæç¤ºé˜…è¯»å…¶å«ä¹‰

![](../img/build_no_arm_conf.png)

#### KEIL_C51 å·¥å…·é“¾

?>ç•¥

#### SDCC å·¥å…·é“¾

å¯¹äº **SDCC** çš„é…ç½®ï¼Œè§ä¸‹å›¾ï¼š

![](../img/cmp_conf_sdcc.png)

- å…¶ä¸­å¸¦æœ‰ **<>** çš„é€‰é¡¹ï¼Œè¢« **<>** åŒ…å«çš„å†…å®¹åº”è¯¥ **è¢«æ›¿æ¢ä¸ºæŸä¸ªå€¼** (ä¸è¦ç†ä¼š json éªŒè¯å™¨äº§ç”Ÿçš„è­¦å‘Š)ï¼Œå¦‚ä½•å–å€¼è§ **SDCC** çš„æ‰‹å†Œ

***

#### IAR_STM8 å·¥å…·é“¾

?>ç•¥

### ARM å·¥ç¨‹

> å¯¹äº ARM å·¥ç¨‹ï¼Œä¼šæœ‰ä¸€äº›å…¬å…±çš„æ„å»ºé…ç½®ï¼Œå¦‚ä¸‹

![](../img/build_conf.png)

- **CPU ç±»å‹**ï¼šCortex ç³»åˆ—å
  
- **ç¡¬ä»¶æµ®ç‚¹é€‰é¡¹**ï¼šCPU çš„ç¡¬ä»¶æµ®ç‚¹å¼€å…³
  
- **ä½¿ç”¨é“¾æ¥è„šæœ¬**ï¼šæ˜¯å¦è¦ä½¿ç”¨è‡ªå®šä¹‰çš„é“¾æ¥è„šæœ¬
  - `æ‰“å¼€`æ­¤é¡¹ï¼Œä¼šå‡ºç°ä¸€ä¸ª**é“¾æ¥è„šæœ¬è·¯å¾„**é€‰é¡¹ï¼Œä½ éœ€è¦æŒ‡å®šä¸€ä¸ªé“¾æ¥è„šæœ¬è·¯å¾„
  
    ![](../img/build_use_custom_lds.png)

  - `å…³é—­`æ­¤é¡¹ï¼Œä¼šå‡ºç°ä¸€ä¸ª**RAM/FLASHå¸ƒå±€**é€‰é¡¹ï¼Œä½ éœ€è¦æ‰“å¼€å®ƒä¸ºèŠ¯ç‰‡è®¾ç½®å‚¨å­˜å™¨çš„åœ°å€å¤§å°ä¿¡æ¯
  
    ![](../img/build_nouse_custom_lds.png)
  
- **ç¼–è¯‘å™¨é€‰é¡¹**ï¼šå…¶ä»–çš„ç¼–è¯‘å‚æ•°ï¼Œç‚¹å‡»ä¿®æ”¹æŒ‰é’®ï¼Œä¼šæ‰“å¼€ä¸€ä¸ª json é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„å­—æ®µå³å¯ï¼Œæ‰€æœ‰å­—æ®µå¸¦æœ‰æ‚¬åœæç¤ºå’Œè¡¥å…¨ï¼Œå¯ä»¥æ ¹æ®æ‚¬åœæç¤ºé˜…è¯»å…¶å«ä¹‰

#### AC5/AC6 (ARMCC) å·¥å…·é“¾

æ‰“å¼€**ç¼–è¯‘é…ç½®**ï¼šç‚¹å‡»ä¸‹å›¾æŒ‰é’®æ‰“å¼€å¯¹åº”çš„é…ç½®

![](https://img-blog.csdnimg.cn/20200825104122532.png)

**ç¼–è¯‘é…ç½®** å¸¦æœ‰ **æ‚¬åœæç¤º** å’Œ **è‡ªåŠ¨è¡¥å…¨**

![](https://img-blog.csdnimg.cn/20200316134804816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODMzODEw,size_16,color_FFFFFF,t_70)

**åˆ‡æ¢å·¥å…·é“¾**

![](https://img-blog.csdnimg.cn/20200825104020726.png)

***

#### ARM-GCC å·¥å…·é“¾

?>ç•¥

***

## é™„åŠ è‡ªå®šä¹‰å‘½ä»¤åˆ°æ„å»ºæµç¨‹ä¸­ ğŸ’¡

**ç¼–è¯‘é…ç½®**->**afterBuildTasksã€beforeBuildTasks**  ä½¿ç”¨ CMD æ‰§è¡Œï¼Œå¯ç”¨äºæ‰©å±•ç¼–è¯‘æµç¨‹ï¼Œå…¶ä¸­ï¼š

  - `beforeBuildTasks` ä»£è¡¨æ„å»ºå‰è¦æ‰§è¡Œçš„æ“ä½œ

  - `afterBuildTasks` ä»£è¡¨æ„å»ºåè¦æ‰§è¡Œçš„æ“ä½œ

å‘½ä»¤ä¸­å¯ç”¨çš„ **è·¯å¾„å˜é‡**, å˜é‡åä¸åŒºåˆ†å¤§å°å†™ï¼š

>å˜é‡åï¼š\${targetName}ï¼Œå«ä¹‰ï¼šé¡¹ç›®åç§°ï¼›
>
>å˜é‡åï¼š\${exeDir}ï¼Œå«ä¹‰ï¼šeide å†…ç½®æ„å»ºå·¥å…·æ‰€åœ¨ç›®å½•ï¼›
>
>å˜é‡åï¼š\${ToolDir}ï¼Œå«ä¹‰ï¼š ç¼–è¯‘å·¥å…·é“¾æ ¹ç›®å½•ï¼›
>
>å˜é‡åï¼š\${OutDir}ï¼Œå«ä¹‰ï¼šé¡¹ç›®è¾“å‡ºç›®å½•ï¼›
>
>å˜é‡åï¼š\${CompileToolDir}ï¼Œå«ä¹‰ï¼šç¼–è¯‘å·¥å…·æ‰€åœ¨ç›®å½•ï¼›
>
>å˜é‡åï¼š\${toolPrefix}, å«ä¹‰ï¼šGCC å·¥å…·é“¾å‰ç¼€ï¼Œå¦‚: arm-none-eabi-
>
>ç¤ºä¾‹ï¼ŒåŠ å…¥ä»¥ä¸‹å‘½ä»¤åˆ° afterBuildTasksï¼šdel "${OutDir}\\*.o"ï¼Œå«ä¹‰ï¼šåœ¨ç¼–è¯‘ç»“æŸååˆ é™¤è¾“å‡ºç›®å½•ä¸‹æ‰€æœ‰çš„ .o æ–‡ä»¶
>
>![](https://img-blog.csdnimg.cn/20200314130436141.png)

### é€šè¿‡ HEX ç”Ÿæˆ Bin æ–‡ä»¶

åœ¨ç¼–è¯‘é€‰é¡¹ ->**afterBuildTasks** ä¸­æ·»åŠ ä¸‹å›¾æ‰€ç¤ºå‘½ä»¤
```json
{
	"name": "output bin file",
    "command": "\"${exeDir}\\hex2bin.exe\" -b -c \"${outDir}\\${targetName}.hex\""
}
```

### ARMCC ç”Ÿæˆ S19 æ ¼å¼çš„çƒ§å½•æ–‡ä»¶

åœ¨ç¼–è¯‘é€‰é¡¹ ->**afterBuildTasks** ä¸­æ·»åŠ ä¸‹å›¾æ‰€ç¤ºå‘½ä»¤

```json
{
	"name": "output s19",
    "command": "\"${CompileToolDir}\\fromelf\" --m32combined -o \"${OutDir}\\${targetName}.s19\" \"${OutDir}\\${targetName}.axf\""
}
```
***

### æŸ¥çœ‹ GCC ç”Ÿæˆçš„ç¨‹åºå¤§å°ä¿¡æ¯

åœ¨ç¼–è¯‘é€‰é¡¹ ->**afterBuildTasks** ä¸­æ·»åŠ ä¸‹å›¾æ‰€ç¤ºå‘½ä»¤

```json
{
	"name": "show total size",
	"command": "\"${CompileToolDir}\\${toolPrefix}size\" \"${OutDir}\\${targetName}.elf\""
}
```
