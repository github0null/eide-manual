# çƒ§å½•ç¨‹åºåˆ°ç›®æ ‡èŠ¯ç‰‡ ğŸ’¾

> æ³¨ï¼šä½¿ç”¨æŸäº›çƒ§å½•å™¨æ—¶å¯èƒ½éœ€è¦è®¾ç½®å…¶å®‰è£…è·¯å¾„ï¼Œå¦‚æœå®‰è£…è·¯å¾„è®¾ç½®ä¸ºç©ºï¼Œæ’ä»¶å°†åœ¨ç¯å¢ƒå˜é‡ä¸­æœç´¢å…¶å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®

## å®‰è£…çƒ§å½•å·¥å…·

eide æ”¯æŒå¤šç§çƒ§å½•å·¥å…·ï¼Œä½†è¿™äº›å·¥å…·å¹¶ä¸é›†æˆåˆ° eide å®‰è£…åŒ…å†…ï¼Œå› æ­¤åœ¨ä½¿ç”¨çƒ§å½•åŠŸèƒ½å‰ï¼Œä½ éœ€è¦å®‰è£…ç›¸åº”çš„çƒ§å½•å·¥å…·ç¨‹åº

å®‰è£…æ–¹æ³•æœ‰ä¸¤ç§ï¼š**è‡ªåŠ¨å®‰è£…** å’Œ **æ‰‹åŠ¨å®‰è£…**

### è‡ªåŠ¨å®‰è£…

ç›´æ¥ç‚¹å‡»ä¸‹è½½æŒ‰é’®è§¦å‘ä¸‹è½½ï¼Œeide ä¼šæ£€æŸ¥ç›¸åº”çš„çƒ§å½•å·¥å…·æ˜¯å¦å·²å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸‹è½½å·¥å…·ï¼Œåˆ™ä¼šå¼¹å‡ºæ˜¯å¦å®‰è£…çš„æç¤ºæ¡†ï¼Œé€‰æ‹©ç«‹å³å®‰è£…å³å¯

![](../../img/auto_install_flasher.png)

### æ‰‹åŠ¨å®‰è£…

è‡ªè¡Œä¸‹è½½ç›¸åº”çš„çƒ§å½•å·¥å…·ï¼Œå¹¶åœ¨**æ’ä»¶è®¾ç½®**ä¸­è¿›è¡Œç›¸åº”çš„è·¯å¾„è®¾ç½®

å¦‚ä½•æ“ä½œï¼Ÿ è§æœ¬ç« ä¸­å¯¹æ¯ç§çƒ§å½•å·¥å…·çš„ç›¸åº”ä»‹ç»

***

## C51 å·¥ç¨‹

### ä½¿ç”¨ stcgal çƒ§å½•

#### å®‰è£…

> 1. å®‰è£… **Python3**
>
> 2. å®‰è£… **stcgal** æ¨¡å—, å‘½ä»¤ï¼š`pip3 install stcgal --user`

!> stcgal å±äºç¬¬ä¸‰æ–¹çš„çƒ§å½•å·¥å…·ï¼Œå¦‚æœæ— æ³•æ­£å¸¸çƒ§å½•ï¼Œå»ºè®®ä½¿ç”¨èŠ¯ç‰‡å‚å®¶æä¾›çš„çƒ§å½•å·¥å…·

#### èŠ¯ç‰‡æ”¯æŒ

stcgal æ”¯æŒçš„èŠ¯ç‰‡å‹å·æœ‰é™ï¼Œè¯¦è§ï¼šhttps://github.com/grigorig/stcgal/blob/master/doc/MODELS.md

```ini
# ä»¥ä¸‹èŠ¯ç‰‡æ”¯æŒä¿¡æ¯æ‘˜è‡ª stcgal æ–‡æ¡£

stcgal should fully support STC 89/90/10/11/12/15/8 series MCUs.

So far, stcgal was tested with the following MCU models:

* STC89C52RC (BSL version: 4.3C/6.6C)
* STC90C52RC (BSL version: 4.3C)
* STC89C54RD+ (BSL version: 4.3C)
* STC12C2052 (BSL version: 5.8D)
* STC12C2052AD (BSL version: 5.8D)
* STC12C5608AD (BSL version: 6.0G)
* STC12C5A16S2 (BSL version: 6.2I)
* STC12C5A60S2 (BSL version: 6.2I/7.1I)
* STC11F02E (BSL version: 6.5K)
* STC10F04XE (BSL version: 6.5J)
* STC11F08XE (BSL version: 6.5M)
* STC12C5204AD (BSL version: 6.6H)
* STC15F104E (BSL version: 6.7Q)
* STC15F204EA (BSL version: 6.7R)
* STC15L104W (BSL version: 7.1.4Q)
* STC15F104W (BSL version: 7.1.4Q and 7.2.5Q)
* IAP15F2K61S2 (BSL version: 7.1.4S)
* STC15L2K16S2 (BSL version: 7.2.4S)
* IAP15L2K61S2 (BSL version: 7.2.5S)
* STC15W408AS (BSL version: 7.2.4T)
* STC15W4K56S4 (BSL version: 7.3.4T, UART and USB mode)
* STC8A8K64S4A12 (BSL version: 7.3.9U)
* STC8F2K08S2 (BSL version: 7.3.10U)
```

#### ç”¨æ³•

STC çš„ä¸‹è½½é…ç½®è¾ƒå¤šï¼Œå°†åœ¨é…ç½®æ–‡ä»¶é‡Œè¿›è¡Œï¼Œå¯ä»¥ç‚¹å‡»ä¸‹å›¾æŒ‰é’®æ‰“å¼€é…ç½®

**å¦‚æœå¿½ç•¥æ­¤æ­¥éª¤ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®**ï¼Œé»˜è®¤é…ç½®è§ [stcgal usage](https://github.com/grigorig/stcgal/blob/master/doc/USAGE.md)

![](https://img-blog.csdnimg.cn/20201204182929347.png)

é…ç½®æ–‡ä»¶çš„é…ç½®æè¿°ç¿»è¯‘è‡ª [stcgal usage](https://github.com/grigorig/stcgal/blob/master/doc/USAGE.md)ï¼Œå¸¦æœ‰æ‚¬åœæç¤ºå’Œè‡ªåŠ¨è¡¥å…¨

**"[]" å·**é‡Œæè¿°äº†é€‚ç”¨äºæ­¤é…ç½®çš„èŠ¯ç‰‡å‹å·ï¼Œä¾‹å¦‚ï¼š**\[ALL\]** è¡¨ç¤ºé€‚ç”¨äºæ‰€æœ‰å‹å·

![](https://img-blog.csdnimg.cn/20200303140748914.png)

æ³¨æ„ï¼šstcgal ç”¨æ³•ä¸ STC å®˜æ–¹çš„çƒ§å½•å·¥å…·ä¸€æ ·ï¼Œåœ¨é¢æ¿è¾“å‡º **Cycling power done** ä¹‹åï¼Œéœ€è¦**å¤ä½ stc èŠ¯ç‰‡ æˆ–è€… å…³é—­ç„¶åæ‰“å¼€èŠ¯ç‰‡ç”µæº**ï¼Œè¿™æ ·èŠ¯ç‰‡æ‰èƒ½æ£€æµ‹åˆ° ISP å‘½ä»¤ï¼Œè¿›å…¥åˆ°ä¸‹è½½æµç¨‹

### ä½¿ç”¨ stcflash çƒ§å½•

#### å®‰è£…

> 1. å®‰è£… **Python3**
> 
> 2. å®‰è£… **pyserial** æ¨¡å—, å‘½ä»¤ï¼š`pip3 install pyserial --user`
> 
> 3. ä¸‹è½½ [stcflash.py](https://github.com/sms-wyt/stcflash/blob/master/stcflash.py), **å¹¶å¤åˆ¶åˆ°é¡¹ç›®çš„ç›®å½•ä¸‹**ï¼Œå¿«æ·ä¸‹è½½åœ°å€ï¼šhttps://cloud.github0null.io/s/R4SY?path=%2F%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7

!> stcflash å±äºç¬¬ä¸‰æ–¹çš„çƒ§å½•å·¥å…·ï¼Œå¦‚æœæ— æ³•æ­£å¸¸çƒ§å½•ï¼Œå»ºè®®ä½¿ç”¨èŠ¯ç‰‡å‚å®¶æä¾›çš„çƒ§å½•å·¥å…·

#### ä»‹ç»

```ini
#
# ä»¥ä¸‹æ‘˜è‡ª stcflash æ–‡æ¡£ (https://github.com/sms-wyt/stcflash/blob/master/README.md)
#

# stcflash
  Add support for STC8 series(STC8A,STC8F,STC8H,STC8C) and STC15 series

# ä»‹ç»
  stcflashä¸»è¦æ˜¯åŸºäºhttps://github.com/laborer/stcflash çš„stcflashä¿®æ”¹è€Œæ¥ï¼ŒåŸç‰ˆçš„stcflashåªæ”¯æŒä¸€äº›æ¯”è¾ƒæ—§ç³»åˆ—çš„STCå•ç‰‡æœºï¼Œ
  æˆ‘åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†å¯¹STC8å…¨ç³»åˆ—ï¼ˆSTC8Aã€STC8Fã€STC8Hã€STC8Cï¼‰å’ŒSTC15ç³»åˆ—çš„ä¸‹è½½æ”¯æŒã€‚

# æ–°å¢åŠŸèƒ½
  1ã€æ·»åŠ å¯¹STC8å’ŒSTC15ç³»åˆ—å•ç‰‡æœºçš„ä¸‹è½½æ”¯æŒ
  2ã€å¯¹äºSTC8ç³»åˆ—å’ŒSTC15ç³»åˆ—ï¼Œæ–°å¢æœ€é«˜æ³¢ç‰¹ç‡è®¾ç½®æŒ‡ä»¤--highbaud
  3ã€å¯¹äºSTC8ç³»åˆ—å’ŒSTC15ç³»åˆ—ï¼Œæ–°å¢æœ€é«˜æ³¢ç‰¹ç‡æ”¯æŒåˆ°460800
  3ã€æ–°å¢å¯¹äºSTC8å’ŒSTC15ç³»åˆ—å•ç‰‡æœºçš„åŸºæœ¬ä¿¡æ¯è¯»å–æ˜¾ç¤º,åŒ…æ‹¬èŠ¯ç‰‡å‹å·ã€ç‰ˆæœ¬ã€ç¨‹åºç©ºé—´å’Œå‡ºå‚åºåˆ—å·ç­‰ã€‚

# stcflashåŸºæœ¬ä½¿ç”¨æ–¹æ³•

## ä½¿ç”¨æ¡ä»¶
  1ã€éœ€è¦pythonç¯å¢ƒï¼Œæ¨èpython3
  2ã€å®‰è£…pyserialæ¨¡å—

## ä½¿ç”¨å‘½ä»¤
  1ã€æŒ‰ç…§é»˜è®¤å‚æ•°
    ./stcflash.py xxx.hex
  2ã€æŒ‡å®šæœ€ä½æ³¢ç‰¹ç‡ã€æœ€é«˜æ³¢ç‰¹ç‡å’Œé€šä¿¡ç«¯å£
    ./stcflash.py xxx.hex --port COM3 --lowbaud 2400 --highbaud 460800
  3ã€å…¶ä»–å‘½ä»¤å¯ä»¥å‚è€ƒhttps://github.com/laborer/stcflash çš„README.md

# æ³¨æ„äº‹é¡¹
  1ã€å¯¹äºSTC8ç³»åˆ—å’ŒSTC15ç³»åˆ—ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šæœ€ä½æ³¢ç‰¹ç‡å’Œæœ€é«˜æ³¢ç‰¹ç‡ï¼Œé»˜è®¤æœ€ä½æ³¢ç‰¹ç‡ä¸º2400ï¼Œæœ€é«˜æ³¢ç‰¹ç‡ä¸º115200
  2ã€æœ€ä½æ³¢ç‰¹ç‡å»ºè®®ä½¿ç”¨é»˜è®¤2400ï¼Œä»¥ä¾¿å•ç‰‡æœºçš„æ­£å¸¸æ£€æµ‹
  3ã€å¯¹äºSTC8ç³»åˆ—å’ŒSTC15ç³»åˆ—ï¼Œæœ€é«˜æ³¢ç‰¹ç‡è™½ç„¶å¯ä»¥æŒ‡å®š1200-460800çš„ä»»æ„æ•°å­—ï¼Œä½†ä¸ºäº†å¢åŠ ä¸‹è½½çš„æˆåŠŸç‡ï¼Œå»ºè®®æŒ‰ç…§å›ºå®šæ³¢ç‰¹ç‡è®¾ç½®ï¼Œå¸¸è§æ³¢ç‰¹ç‡å¦‚ä¸‹ï¼š
  460800ã€230400ã€115200ã€57600ã€38400ã€28800ã€19200ã€14400ã€9600ã€4800ã€2400ã€1200
  4ã€å¯¹äºSTC15ç³»åˆ—ï¼Œæœ€é«˜æ³¢ç‰¹ç‡ä¸å®œè®¾ç½®è¿‡ä½ï¼ˆå»ºè®®ä¸å°äº115200ï¼‰ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä¸‹è½½å¤±è´¥æƒ…å†µã€‚å› ä¸ºSTC15ç³»åˆ—å‹å·è¾ƒå¤šï¼Œæ¡æ‰‹åè®®æœ‰å·®åˆ«ï¼Œæ²¡æ³•åšåˆ°å…¨æ³¢ç‰¹ç‡å…¼å®¹
  5ã€æœ¬äººæµ‹è¯•çš„å•ç‰‡æœºæœ‰STC89C52ã€STC15W4K48S4ã€STC15L2K08S2ã€STC8A8K64S4A12å’ŒSTC8H8K64Uï¼Œç”±äºæ ·æœ¬å®åœ¨å¤ªç¨€å°‘ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å…¨éƒ¨å‹å·éƒ½èƒ½æ­£å¸¸è¯†åˆ«ä¸‹è½½
  6ã€å•ç‰‡æœºçš„å‹å·æ˜¯é€šè¿‡ç‰¹æ®Šçš„æ‰‹æ®µè¯±éª—STC-ISP(V6.87H)å¾—åˆ°çš„ï¼ŒæŠŠè¿™äº›å‹å·æ•´åˆåˆ°ä»£ç ä¸­ä¹Ÿæ˜¯æ¯”è¾ƒç¹ççš„ï¼Œçº¯ç²¹æ˜¯ä½“åŠ›åŠ³åŠ¨ã€‚
     æˆ‘åœ¨åŸå…ˆçš„ä»£ç å½“ä¸­æ·»åŠ äº†æ–°çš„é”®æ¥æ˜ å°„æ–°æ·»åŠ çš„å‹å·ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹ä»£ç ã€‚å¦‚æœåé¢STCå†å‡ºæ–°å‹å·ï¼Œå¦‚æœåè®®ä¸ä¸€æ ·ï¼Œè¿˜æ˜¯éœ€è¦åšå…¼å®¹ï¼Œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼
  7ã€å¦‚æœæœ‰ä»»ä½•æ„è§å’Œå»ºè®®ï¼Œæ¬¢è¿æå‡ºï¼Œå…±åŒæ¢è®¨ï¼

```

#### ç”¨æ³•

- é¦–ç‚¹å‡»åˆ‡æ¢çƒ§å½•å·¥å…·åˆ° Custom, å¦‚ä¸‹å›¾

  ![](../img/uploader_cus.png)

- ä¹‹åä¿®æ”¹ `å‘½ä»¤è¡Œ` å±æ€§ï¼Œå¡«å†™ stcflash çš„çƒ§å½•å‘½ä»¤, ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ (è¯¦è§ï¼š[è‡ªå®šä¹‰å‘½ä»¤çƒ§å½•](zh-cn/download_to_device?id=è‡ªå®šä¹‰çƒ§å½•å‘½ä»¤))ï¼š
  
  `python ./tools/stcflash.py -p ${port} "${hexFile}"`

- ç‚¹å‡»ä¸‹è½½æŒ‰é’®ï¼Œå¼€å§‹çƒ§å½•

- å‘½ä»¤è¡Œä¼šæç¤ºæ­£åœ¨æ£€æµ‹èŠ¯ç‰‡ï¼Œè¿™æ—¶éœ€è¦å¤ä½èŠ¯ç‰‡ï¼Œæ‰èƒ½è¿›å…¥åˆ°ä¸‹è½½æµç¨‹

***

## STM8 å·¥ç¨‹

> STM8 æš‚æ—¶ä»…æ”¯æŒ STVP çƒ§å½•å·¥å…·

### ä½¿ç”¨ STVP çƒ§å½•

> STVP å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://www.st.com/zh/development-tools/stvp-stm8.html
> 
> STVP ç²¾ç®€ç‰ˆä¸‹è½½åœ°å€ï¼šhttps://cloud.github0null.io/s/R4SY?path=%2F%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7

å®‰è£…å®Œæˆä¹‹åéœ€è¦åœ¨ eide æ’ä»¶è®¾ç½®ä¸­è®¾ç½® `STVP_CmdLine.exe` çš„ç»å¯¹è·¯å¾„

æ‰“å¼€ vscode è®¾ç½®ï¼Œæœç´¢æ è¾“å…¥ï¼š`EIDE.STM8.STVP.CliExePath`, æœç´¢åˆ° STVP è®¾ç½®åï¼Œå°†è·¯å¾„å¡«å†™åˆ°å…¶ä¸­å³å¯

![](../img/stvp_setting.png)

STVP å·¥å…·é…ç½®ç•Œé¢å¦‚å›¾

![](https://img-blog.csdnimg.cn/2020120418415026.png)

!> **æ³¨æ„ï¼š** å¦‚æœéœ€è¦è®¾ç½®é€‰é¡¹å­—èŠ‚ä»¥å¼€å¯ç›¸å…³å¤–è®¾ï¼Œè¯·æ‰“å¼€ STVP å®Œæˆé€‰é¡¹å­—èŠ‚çš„é…ç½®ï¼Œç„¶åç”Ÿæˆä¸º hex æˆ– bin æ–‡ä»¶ï¼Œå°†æ­¤æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°é¡¹ç›®çš„ STVP çƒ§å½•è®¾ç½®: `é€‰é¡¹å­—èŠ‚æ–‡ä»¶è·¯å¾„` ä¸­

åœ¨ä¿®æ”¹å¥½é…ç½®ä¹‹åï¼Œè¿æ¥å¥½ STLinkï¼Œç‚¹å‡»ä¸‹è½½æŒ‰é’®å¼€å§‹ä¸‹è½½

![](https://img-blog.csdnimg.cn/20201204184429743.png)

***

## ARM å·¥ç¨‹

eide æ”¯æŒä¸»æµçš„ 4 ç§çƒ§å½•å·¥å…·

![](./../img/flasher_list.png)

### ä½¿ç”¨ JLink çƒ§å½•

> è¦ä½¿ç”¨ JLink, å¿…é¡»å…ˆå®‰è£… JLink è½¯ä»¶ï¼Œå¹¶ä¸” JLink è½¯ä»¶çš„ç‰ˆæœ¬å¿…é¡»åœ¨ V6.50 åŠä»¥ä¸Š
> 
> JLink_V650 ä¸‹è½½åœ°å€ï¼šhttps://www.segger.com/downloads/jlink/JLink_Windows_V650.exe

å®‰è£…å®Œä¹‹åï¼Œæ‰“å¼€ vscode è®¾ç½®ï¼Œåœ¨æœç´¢æ è¾“å…¥ï¼š`EIDE.JLink.InstallDirectory`

æœç´¢åˆ° JLink è®¾ç½®åï¼Œå°† JLink å®‰è£…ç›®å½•ä½ç½®å¡«å†™åˆ°è¾“å…¥æ¡†å†…å³å¯å®Œæˆ JLink è·¯å¾„è®¾ç½®

![](../img/jlink_setting.png)

ä¹‹åæ‰“å¼€ eide é¡¹ç›®çš„ â€œçƒ§å½•é…ç½®â€ æ ï¼Œåˆ‡æ¢åˆ° JLinkï¼Œè¿›è¡Œé…ç½®

é…ç½®å®Œæ¯•ä¹‹åï¼Œå³å¯ç‚¹å‡» â€œä¸‹è½½ç¨‹åºâ€ æŒ‰é’®è¿›è¡Œçƒ§å½•

![](../img/jlink_flash_conf.png)

#### é€‰æ‹©èŠ¯ç‰‡åç§°

- åœ¨ä½¿ç”¨ JLink çƒ§å½•åŠŸèƒ½çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®š **èŠ¯ç‰‡åç§°**ï¼Œåœ¨è¾“å…¥æ¡†å†…é”®å…¥åç§°ï¼Œå°†ä»å¯ç”¨çš„èŠ¯ç‰‡åˆ—è¡¨ä¸­è¿›è¡Œç­›é€‰

  ![](../img/jlink_dev_list.png)

- eide å°†åœ¨**å¯åŠ¨æ—¶**ä» **JLink.exe** ä»¥åŠ **JLink å®‰è£…ç›®å½•ä¸‹çš„ JLinkDevices.xml** ä¸­è·å–å¯ç”¨çš„èŠ¯ç‰‡åˆ—è¡¨

  å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–è·¯å¾„ä¸‹çš„ **JLinkDevices.xml** æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶è®¾ç½® **EIDE.JLink.DeviceXmlPath** è¿›è¡ŒæŒ‡å®š

- å½“ä½ æ›´æ”¹äº† **JLinkDevices.xml** çš„å†…å®¹åï¼Œå¯ä»¥ä½¿ç”¨ **eide.ReloadJlinkDevs** å‘½ä»¤é‡æ–°åŠ è½½ JLink èŠ¯ç‰‡åˆ—è¡¨

  ![](../img/eide_reload_jlink_devs.png)

### ä½¿ç”¨ STLink çƒ§å½•

> å¯¹äº STLink, æœ¬è½¯ä»¶ä½¿ç”¨ `STLink Utility` ä½œä¸ºçƒ§å½•å·¥å…·
> 
> STLink Utility å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://www.st.com/zh/development-tools/stsw-link004.html
>
> å…±äº«ä¸‹è½½åœ°å€ï¼šhttps://cloud.github0null.io/s/R4SY?path=%2F%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7

> V2.12.3 åŠä»¥åç‰ˆæœ¬ï¼Œå…¼å®¹ä½¿ç”¨ `STM32CubeProgramer` å·¥å…·è¿›è¡Œçƒ§å½•

å®‰è£…å®Œä¹‹åï¼Œæ‰“å¼€ vscode è®¾ç½®ï¼Œåœ¨æœç´¢æ è¾“å…¥ï¼š`EIDE.STLink.ExePath`

æœç´¢åˆ° STLink è®¾ç½®åï¼Œ**åœ¨ `STLink Utility`/`STM32CubeProgramer` å®‰è£…ç›®å½•ä¸­æ‰¾åˆ° `xxx_CLI.exe` çš„ä½ç½®**ï¼Œå¹¶å°†å…¶å¡«å†™åˆ°è¾“å…¥æ¡†å†…å³å¯å®Œæˆ STLink è·¯å¾„è®¾ç½®

![](../img/stlink_setting.png)

ä¹‹åæ‰“å¼€ eide é¡¹ç›®çš„ â€œçƒ§å½•é…ç½®â€ æ ï¼Œåˆ‡æ¢åˆ° STLinkï¼Œè¿›è¡Œé…ç½®

é…ç½®å®Œæ¯•ä¹‹åï¼Œå³å¯ç‚¹å‡» â€œä¸‹è½½ç¨‹åºâ€ æŒ‰é’®è¿›è¡Œçƒ§å½•

![](../img/stlink_flasher_conf.png)

### ä½¿ç”¨ pyocd çƒ§å½•

> æ³¨æ„ï¼špyocd éœ€è¦ python3 æ”¯æŒï¼Œå¿…é¡»å…ˆå®‰è£… python3
>
> pyocd ä¸»è¦è¢«ç”¨æ¥æ”¯æŒ DAPLink å’Œ STLink

1. å‘½ä»¤è¡Œè¾“å…¥ `pip3 install pyocd` å®‰è£… pyocd

2. ä» github ä¸‹è½½ [usblib](https://github.com/libusb/libusb/releases/tag/v1.0.21)

 **è§£å‹ usblib åï¼Œå°† libusb.dll å¤åˆ¶åˆ° python.exe æ‰€åœ¨çš„ç›®å½•ï¼Œæ³¨æ„ï¼šæ‰€é€‰æ‹©çš„ libusb.dll å¿…é¡»è¦å’Œç”µè„‘ä¸Šå®‰è£…çš„ python æ˜¯åŒä¸€ä½“ç³»ç»“æ„ï¼Œä¾‹å¦‚ï¼špython3_x86 ç‰ˆæœ¬å¯¹åº” MS32 ç›®å½•ä¸‹çš„ dll**

 > æç¤ºï¼šå½“ libusb åœ¨ python æ ¹ç›®å½•æ— æ³•è¢« pyocd è¯†åˆ«æ—¶ï¼Œå¯ä»¥å°è¯•å°† libusb.dll æ”¾åœ¨ C:\Windows\System32 ä¸‹

 ![](https://img-blog.csdnimg.cn/20200707213346603.png)

3. è¿æ¥ ç›®æ ‡æ¿ï¼Œå‘½ä»¤è¡Œè¾“å…¥ `pyocd list` æ£€æŸ¥ pyocd æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜åˆ™ä¼šè¾“å‡ºå·²è¿æ¥çš„è®¾å¤‡åˆ—è¡¨

 ![](https://img-blog.csdnimg.cn/20200707213951601.png)

4. æ‰“å¼€ EIDE é¡¹ç›®ï¼Œé…ç½®çƒ§å½•è®¾ç½®
   
   - å¡«å†™ç›®æ ‡èŠ¯ç‰‡åç§°

     ![](https://img-blog.csdnimg.cn/20200707214308226.png)

   - å‘½ä»¤è¡Œè¾“å…¥ `pyocd list -t`ï¼ŒæŸ¥çœ‹ **å†…ç½®æ”¯æŒ** çš„èŠ¯ç‰‡ï¼Œå¦‚æœä¸Šä¸€æ­¥å¡«å†™çš„èŠ¯ç‰‡åå­˜åœ¨ï¼Œ**åˆ™å¯ä»¥è·³è¿‡åç»­æ­¥éª¤**ï¼Œå¦åˆ™ç»§ç»­ä¸‹ä¸€æ­¥

     ![](https://img-blog.csdnimg.cn/2020070721482367.png)

   - æ‰“å¼€ config å±æ€§ï¼Œé…ç½®åŒ…å«è¯¥èŠ¯ç‰‡çš„ keil åŒ…è·¯å¾„ï¼ˆåŒ…è·¯å¾„å¯ä»¥ä½¿ç”¨ç›¸å¯¹äºå·¥ä½œåŒºæ ¹ç›®å½•çš„**ç›¸å¯¹è·¯å¾„**ï¼‰ï¼Œå¦‚æœå®Œæ•´çš„ keil åŒ…å¤ªå¤§ï¼Œå¯ä»¥ç”¨ç®€åŒ–ç‰ˆçš„, ä»“åº“åœ°å€: https://cloud.github0null.io/s/R4SY?path=%2Fpyocd%20%E8%8A%AF%E7%89%87%E5%8C%85

     æç¤ºï¼šæ­¤é…ç½®æ–‡ä»¶é‡Œä¹Ÿå¯ä»¥å¡«å†™ä¸€äº›å…¶ä»–çš„ pyocd é…ç½®é€‰é¡¹ï¼Œå…·ä½“å‚è€ƒ [pyocd é…ç½®æ–‡æ¡£](https://github.com/pyocd/pyOCD/tree/master/docs)

     ![](https://img-blog.csdnimg.cn/20200707215417409.png)

5. è¿æ¥ç›®æ ‡æ¿ï¼Œç‚¹å‡»ä¸‹è½½æŒ‰é’®å¯åŠ¨ä¸‹è½½

 ![](https://img-blog.csdnimg.cn/20200707215605884.png)

***

### ä½¿ç”¨ OpenOCD çƒ§å½•

> OpenOCD-v0.10.0 ä¸‹è½½åœ°å€ï¼šhttps://cloud.github0null.io/s/R4SY?path=%2F%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7

1. æ‰“å¼€è®¾ç½®æœç´¢ï¼š`EIDE.OpenOCD.ExePath`, è®¾ç½®å¥½ OpenOCD.exe çš„è·¯å¾„

 ![](../img/openocd_conf.png)

2. å°†çƒ§å½•é…ç½®åˆ‡æ¢åˆ° OpenOCDï¼Œè®¾ç½® `target` å’Œ `interface`ã€‚

 ![](https://img-blog.csdnimg.cn/20200714121238782.png)

3. ç‚¹å‡»ä¸‹è½½æŒ‰é’®å®Œæˆä¸‹è½½

 ![](https://img-blog.csdnimg.cn/20200714121616638.png)


#### æ³¨æ„äº‹é¡¹ï¼š

- æ’ä»¶å°†ä»ä»¥ä¸‹ç›®å½•ä¸­æœç´¢å¯ç”¨çš„ cfg é…ç½®æ–‡ä»¶

  - **å½“å‰å·¥ä½œåŒºå†…ï¼š**

    `.`

    `.eide`

    `tools`

  - **OpenOCDå®‰è£…ç›®å½•å†…ï¼š**

    `scripts`

    `share/openocd/scripts`

***

## **è‡ªå®šä¹‰çƒ§å½•å‘½ä»¤**

> å¦‚æœä½ æƒ³ä½¿ç”¨æ”¯æŒå‘½ä»¤è¡Œçš„å…¶ä»–çƒ§å½•ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨ `è‡ªå®šä¹‰shellå‘½ä»¤` æ¥è¿›è¡Œçƒ§å½•

### ç”¨æ³•

é¦–ç‚¹å‡»åˆ‡æ¢çƒ§å½•å·¥å…·åˆ° Shell, å¦‚ä¸‹å›¾

![](../img/uploader_cus.png)

ä¹‹åä¿®æ”¹ `å‘½ä»¤è¡Œ` å±æ€§ï¼Œå¡«å†™ä½ è¦ä½¿ç”¨çš„çƒ§å½•å·¥å…·çš„ç›¸åº”çš„å‘½ä»¤å³å¯

å‘½ä»¤è¡Œæ”¯æŒä¸€äº›å˜é‡ï¼Œå¦‚ä¸‹ï¼š

- `${programFile}`ï¼šä»£æŒ‡ç¨‹åºæ–‡ä»¶ï¼ˆ`.hex, .bin, .s19`ï¼‰è·¯å¾„

- `${port}`ï¼šä»£æŒ‡ `å¯ç”¨çš„ä¸²å£`ï¼ˆ**æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªä¸²å£å¯ç”¨ï¼Œè¯¥å€¼æ˜¯ä¸²å£åˆ—è¡¨çš„ç¬¬ä¸€ä¸ª**ï¼‰

### ç¤ºä¾‹

> æç¤ºï¼šç¤ºä¾‹å‘½ä»¤ä¸­çš„çƒ§å½•è½¯ä»¶å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å·²è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­

```bash
# ä½¿ç”¨ NuLink çƒ§å½•æ–°å” mcu
NuLink -w APROM "${programFile}"

# ä½¿ç”¨ stcflash çƒ§å½• 8051
python ./tools/stcflash.py -p ${port} "${programFile}"

# ä½¿ç”¨ STM32CubeProgramer + STLink çƒ§å½•ç¨‹åºåˆ° STM32
STM32_Programmer_CLI -c port=SWD FREQ=4000 mode=NORMAL reset=SWrst --download "${programFile}" -v --go

# ä½¿ç”¨ STM32CubeProgramer + STLink å¹¶é€šè¿‡å¤–éƒ¨åŠ è½½ç®—æ³•çƒ§å½•ç¨‹åºåˆ° STM32H750 ç‰‡å¤– QSPI Flash
STM32_Programmer_CLI -c port=SWD FREQ=4000 mode=NORMAL reset=SWrst -el ./STM32H7xx_W25Q128_WeAct.stldr --download "${programFile}" -v --go
```
